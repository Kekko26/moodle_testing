function _typeof(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}define ("local_amos/translator",["exports","core/ajax","core/config","core/notification","core/pubsub","./filter_events","./translator_events","core/templates","core/modal_events","core/modal_factory","core/str"],function(a,b,c,d,f,g,h,i,j,k,l){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;c=o(c);d=o(d);f=n(f);g=o(g);h=o(h);i=o(i);j=o(j);k=o(k);function m(){if("function"!=typeof WeakMap)return null;var a=new WeakMap;m=function(){return a};return a}function n(a){if(a&&a.__esModule){return a}if(null===a||"object"!==_typeof(a)&&"function"!=typeof a){return{default:a}}var b=m();if(b&&b.has(a)){return b.get(a)}var c={},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var e in a){if(Object.prototype.hasOwnProperty.call(a,e)){var f=d?Object.getOwnPropertyDescriptor(a,e):null;if(f&&(f.get||f.set)){Object.defineProperty(c,e,f)}else{c[e]=a[e]}}}c.default=a;if(b){b.set(a,c)}return c}function o(a){return a&&a.__esModule?a:{default:a}}var p=function(){q();u();f.subscribe(g.default.submit,function(a){v(a)})};a.init=p;var q=function(){var a=document.getElementById("amostranslator");a.addEventListener("click",function(a){if(a.target.classList.contains("amostranslation")||a.target.classList.contains("amostranslationview")){var c=a.target.closest("[data-region=\"amostranslatoritem\"].translatable");if("view"==c.getAttribute("data-mode")){r(c,a.ctrlKey).focus();return}}if(a.target.hasAttribute("data-region")&&"timelinelink"==a.target.getAttribute("data-region")){var d=a.target.closest("[data-region=\"amostranslatoritem\"]");a.preventDefault();w(d);return}if(a.target.hasAttribute("data-region")&&"markuptodatelink"==a.target.getAttribute("data-region")){var e=a.target.closest("[data-region=\"amostranslatoritem\"]");a.preventDefault();x(e);return}var b=a.target.closest("[data-paginatorlink]");if(b){a.preventDefault();f.publish(h.default.pagechange,b.getAttribute("data-paginatorlink"))}});a.addEventListener("blur",function(a){if(a.target.hasAttribute("data-region")&&"amoseditor"==a.target.getAttribute("data-region")){s(a.target)}},!0)},r=function(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!1,c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0,d=a.querySelector("[data-region=\"amoseditor\"]"),e=a.querySelector(".amostranslation").clientHeight;a.setAttribute("data-nocleaning",b?"1":"0");d.setAttribute("data-previous",d.value);if(0<c){d.tabIndex=c}if(40<e){d.style.height=e-9+"px"}a.setAttribute("data-mode","edit");return d},s=function(a){var b=a.closest("[data-region=\"amostranslatoritem\"]"),c=b.getAttribute("data-nocleaning"),e=a.getAttribute("data-previous"),f=a.value;if("1"!==c){f=f.trim()}if(e===f&&"1"!==c){a.value=e;b.setAttribute("data-mode","view");return Promise.resolve(!1)}else{b.classList.add("staged");b.classList.remove("outdated");a.disabled=!0;return t(b,f).then(function(c){var d;b.setAttribute("data-mode","view");a.disabled=!1;a.removeAttribute("data-previous");a.innerHTML=a.value=c.translation;b.querySelector("[data-region=\"amostranslationview\"]").innerHTML=c.displaytranslation;b.querySelector("[data-region=\"displaytranslationsince\"]").innerHTML=c.displaytranslationsince+" | ";null===(d=b.querySelector("[data-region=\"markuptodatelink\"]"))||void 0===d?void 0:d.remove();return!0}).catch(d.default.exception)}},t=function(a,d){return(0,b.call)([{methodname:"local_amos_stage_translated_string",args:{stageid:c.default.sesskey,originalid:a.getAttribute("data-originalid"),lang:a.getAttribute("data-language"),text:d,translationid:parseInt(a.getAttribute("data-translationid"))||0,nocleaning:a.getAttribute("data-nocleaning")}}])[0]},u=function(){var a=document.getElementById("amostranslator"),b=a.querySelectorAll(":scope [data-region=\"amostranslatoritem\"].translatable.missing");b.forEach(function(a,b){r(a,!1,b+1)})},v=function(a){var c=document.getElementById("amostranslator"),e=document.getElementById("amosfilter_loading_indicator");c.classList.add("loading");return(0,b.call)([{methodname:"local_amos_get_translator_data",args:{filterquery:a}}])[0].then(function(a){try{var b=JSON.parse(a.json);return i.default.render("local_amos/translator_root",b)}catch(a){return Promise.reject(a)}}).then(function(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"";return i.default.replaceNodeContents(c,a,b)}).then(function(){u();e.classList.add("hidden");c.classList.remove("loading");return!0}).catch(d.default.exception)},w=function(a){var c="";return(0,b.call)([{methodname:"local_amos_get_string_timeline",args:{component:a.getAttribute("data-component"),language:a.getAttribute("data-language"),strname:a.getAttribute("data-stringid")}}])[0].then(function(a){c=(0,l.get_string)("timelineheading","local_amos",a);return i.default.render("local_amos/timeline",a)}).then(function(a){return k.default.create({large:!0,title:c,body:a})}).then(function(a){a.getRoot().on(j.default.hidden,function(){a.destroy()});a.show();return a}).catch(d.default.exception)},x=function(a){return(0,b.call)([{methodname:"local_amos_make_translation_uptodate",args:{originalid:a.getAttribute("data-originalid"),translationid:a.getAttribute("data-translationid")}}])[0].then(function(b){a.classList.remove("outdated");a.setAttribute("data-translationid",b.translationid);a.querySelector("[data-region=\"displaytranslationsince\"]").innerHTML=b.displaytranslationsince+" | ";a.querySelector("[data-region=\"markuptodatelink\"]").remove()}).catch(d.default.exception)}});
//# sourceMappingURL=translator.min.js.map
